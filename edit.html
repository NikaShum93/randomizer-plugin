<!DOCTYPE html>
<html>
<head>
  <title>Рандомайзер: Редактор</title>
  <meta charset="UTF-8" />
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    .preview { margin-top: 20px; border: 1px dashed #ccc; padding: 20px; text-align: center; }
    label { display: block; margin-top: 10px; }
    textarea { width: 100%; height: 100px; }
    select, input[type="number"], input[type="color"], input[type="text"] {
      width: 100%; padding: 5px; margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Редактор рандомайзера</h1>
  <label>Задания (до 40 строк):</label>
  <textarea id="tasks"></textarea>

  <label>Цвет фона:</label>
  <input type="color" id="bgColor" value="#ffffff">

  <label>Прозрачность (0–1):</label>
  <input type="number" id="bgOpacity" min="0" max="1" step="0.1" value="1">

  <label>Обводка (цвет и толщина):</label>
  <input type="color" id="borderColor" value="#000000">
  <input type="number" id="borderWidth" value="2">

  <label>Закругление углов (px):</label>
  <input type="number" id="borderRadius" value="20">

  <label>Размер шрифта (px):</label>
  <input type="number" id="fontSize" value="24">

  <label>Цвет текста:</label>
  <input type="color" id="textColor" value="#000000">

  <label>Выбор шрифта:</label>
  <select id="fontFamily">
    <option value="Roboto">Roboto</option>
    <option value="Open Sans">Open Sans</option>
    <option value="Montserrat">Montserrat</option>
    <option value="Comfortaa">Comfortaa</option>
    <option value="Playfair Display">Playfair Display</option>
    <option value="Raleway">Raleway</option>
    <option value="Ubuntu">Ubuntu</option>
    <option value="Bitter">Bitter</option>
    <option value="Caveat">Caveat</option>
    <option value="Marck Script">Marck Script</option>
    <option value="Bad Script">Bad Script</option>
    <option value="Stalinist One">Stalinist One</option>
  </select>

  <label>Финальный фидбек:</label>
  <input type="text" id="winText" value="Well done!">

  <div class="preview" id="preview">Предпросмотр текста</div>

  <button onclick="generate()">Сгенерировать iFrame</button>
  <pre id="iframeCode"></pre>

  <script>
    const preview = document.getElementById('preview');
    let fontLink = document.createElement("link");
    fontLink.rel = "stylesheet";
    document.head.appendChild(fontLink);

    const updatePreview = () => {
      const font = document.getElementById('fontFamily').value;
      const fontURL = "https://fonts.googleapis.com/css2?family=" + font.replace(/ /g, "+") + "&display=swap";
      fontLink.href = fontURL;

      preview.style.backgroundColor = document.getElementById('bgColor').value;
      preview.style.opacity = document.getElementById('bgOpacity').value;
      preview.style.borderColor = document.getElementById('borderColor').value;
      preview.style.borderWidth = document.getElementById('borderWidth').value + "px";
      preview.style.borderStyle = parseInt(document.getElementById('borderWidth').value) === 0 ? "none" : "solid";
      preview.style.borderRadius = document.getElementById('borderRadius').value + "px";
      preview.style.fontSize = document.getElementById('fontSize').value + "px";
      preview.style.color = document.getElementById('textColor').value;
      preview.style.fontFamily = font;
    };

    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', updatePreview));

    function generate() {
      const tasks = encodeURIComponent(document.getElementById('tasks').value);
      const params = new URLSearchParams({
        tasks,
        bgColor: document.getElementById('bgColor').value,
        bgOpacity: document.getElementById('bgOpacity').value,
        borderColor: document.getElementById('borderColor').value,
        borderWidth: document.getElementById('borderWidth').value,
        borderRadius: document.getElementById('borderRadius').value,
        fontSize: document.getElementById('fontSize').value,
        textColor: document.getElementById('textColor').value,
        fontFamily: document.getElementById('fontFamily').value,
        winText: document.getElementById('winText').value,
      }).toString();
      const fullURL = "https://nikashum93.github.io/randomizer-plugin/main.html?" + params;
      const iframe = `<iframe src="${fullURL}" width="600" height="600" frameborder="0"></iframe>`;
      document.getElementById('iframeCode').textContent = iframe;
    }

    updatePreview();
  </script>
</body>
</html>
